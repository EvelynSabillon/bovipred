<!-- src/app/components/change-password/change-password.component.html -->
<div class="change-password-container">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <button class="btn-back" (click)="cancelChange()">
        <span class="back-icon">â†</span>
        <span>Volver</span>
      </button>
      <h1>Cambiar ContraseÃ±a</h1>
      <p class="subtitle">Actualiza tu contraseÃ±a para mantener tu cuenta segura</p>
    </div>

    <div class="content-wrapper">
      <!-- Tarjeta de informaciÃ³n del usuario -->
      <div class="user-info-card" *ngIf="currentUser">
        <div class="user-avatar">
          <span class="avatar-icon">ğŸ‘¤</span>
        </div>
        <div class="user-details">
          <h3>{{ currentUser.name }} {{ currentUser.apellido }}</h3>
          <p>{{ currentUser.email }}</p>
          <span class="user-role">{{ currentUser.rol }}</span>
        </div>
      </div>

      <!-- PASO 1: VerificaciÃ³n de Email (solo si no estÃ¡ autenticado) -->
      <div class="form-card" *ngIf="emailStep && !currentUser">
        <!-- MENSAJE DE ERROR -->
        <div class="alert alert-error" *ngIf="showError">
          <span class="alert-icon">âš ï¸</span>
          <span class="alert-message">{{ errorMessage }}</span>
          <button class="alert-close" (click)="hideMessages()">Ã—</button>
        </div>

        <!-- MENSAJE DE Ã‰XITO -->
        <div class="alert alert-success" *ngIf="showSuccess">
          <span class="alert-icon">âœ“</span>
          <span class="alert-message">{{ successMessage }}</span>
        </div>

        <div class="email-verification-section">
          <div class="verification-icon">ğŸ“§</div>
          <h3>VerificaciÃ³n de Email</h3>
          <p>Ingresa tu correo electrÃ³nico para continuar con el cambio de contraseÃ±a</p>

          <form (ngSubmit)="verifyEmail()" class="email-form">
            <div class="form-group">
              <label for="email">Correo ElectrÃ³nico *</label>
              <div class="input-wrapper">
                <span class="input-icon">ğŸ“§</span>
                <input
                  type="email"
                  id="email"
                  [(ngModel)]="email"
                  name="email"
                  placeholder="ejemplo@correo.com"
                  required
                  autocomplete="email"
                  [disabled]="loading"
                />
              </div>
            </div>

            <button 
              type="submit" 
              class="btn-submit"
              [disabled]="loading"
              [class.loading]="loading"
            >
              <span *ngIf="!loading">
                <span class="btn-icon">âœ“</span>
                <span>Verificar Email</span>
              </span>
              <span *ngIf="loading" class="loader-wrapper">
                <span class="spinner"></span>
                <span>Verificando...</span>
              </span>
            </button>
          </form>
        </div>
      </div>

      <!-- PASO 2: Formulario de Cambio de ContraseÃ±a -->
      <div class="form-card" *ngIf="!emailStep || currentUser">
        <!-- MENSAJE DE ERROR -->
        <div class="alert alert-error" *ngIf="showError">
          <span class="alert-icon">âš ï¸</span>
          <span class="alert-message">{{ errorMessage }}</span>
          <button class="alert-close" (click)="hideMessages()">Ã—</button>
        </div>

        <!-- MENSAJE DE Ã‰XITO -->
        <div class="alert alert-success" *ngIf="showSuccess">
          <span class="alert-icon">âœ“</span>
          <span class="alert-message">{{ successMessage }}</span>
        </div>

        <!-- Consejos de seguridad -->
        <div class="security-tips">
          <h3>ğŸ’¡ Consejos para una contraseÃ±a segura:</h3>
          <ul>
            <li>Al menos 8 caracteres de longitud</li>
            <li>Combina letras mayÃºsculas y minÃºsculas</li>
            <li>Incluye nÃºmeros y caracteres especiales</li>
            <li>Evita informaciÃ³n personal (nombre, fecha de nacimiento)</li>
            <li>No reutilices contraseÃ±as de otras cuentas</li>
          </ul>
        </div>

        <!-- FORMULARIO -->
        <form (ngSubmit)="onSubmit()" class="change-password-form">
          <!-- ContraseÃ±a Actual -->
          <div class="form-group">
            <label for="current_password">ContraseÃ±a Actual *</label>
            <div class="input-wrapper" [class.error]="!validations.currentPassword.valid">
              <span class="input-icon">ğŸ”’</span>
              <input
                [type]="showCurrentPassword ? 'text' : 'password'"
                id="current_password"
                [(ngModel)]="formData.current_password"
                name="current_password"
                placeholder="Ingresa tu contraseÃ±a actual"
                required
                autocomplete="current-password"
                [disabled]="loading"
              />
              <button
                type="button"
                class="toggle-password"
                (click)="toggleCurrentPassword()"
                [disabled]="loading"
                tabindex="-1"
              >
                <span *ngIf="!showCurrentPassword">ğŸ‘ï¸</span>
                <span *ngIf="showCurrentPassword">ğŸ‘ï¸â€ğŸ—¨ï¸</span>
              </button>
            </div>
            <span class="error-message" *ngIf="!validations.currentPassword.valid">
              {{ validations.currentPassword.message }}
            </span>
          </div>

          <div class="divider"></div>

          <!-- Nueva ContraseÃ±a -->
          <div class="form-group">
            <label for="new_password">Nueva ContraseÃ±a *</label>
            <div class="input-wrapper" [class.error]="!validations.newPassword.valid">
              <span class="input-icon">ğŸ”</span>
              <input
                [type]="showNewPassword ? 'text' : 'password'"
                id="new_password"
                [(ngModel)]="formData.new_password"
                name="new_password"
                placeholder="MÃ­nimo 8 caracteres"
                required
                autocomplete="new-password"
                [disabled]="loading"
                (blur)="onNewPasswordBlur()"
              />
              <button
                type="button"
                class="toggle-password"
                (click)="toggleNewPassword()"
                [disabled]="loading"
                tabindex="-1"
              >
                <span *ngIf="!showNewPassword">ğŸ‘ï¸</span>
                <span *ngIf="showNewPassword">ğŸ‘ï¸â€ğŸ—¨ï¸</span>
              </button>
            </div>
            
            <!-- Indicador de fuerza de contraseÃ±a -->
            <div class="password-strength" *ngIf="formData.new_password">
              <div class="strength-bar">
                <div 
                  class="strength-fill" 
                  [class.weak]="getPasswordStrength() === 'weak'"
                  [class.medium]="getPasswordStrength() === 'medium'"
                  [class.strong]="getPasswordStrength() === 'strong'"
                ></div>
              </div>
              <span class="strength-label">
                Fortaleza: 
                <strong>
                  {{ getPasswordStrength() === 'weak' ? 'DÃ©bil' : 
                     getPasswordStrength() === 'medium' ? 'Media' : 'Fuerte' }}
                </strong>
              </span>
            </div>
            
            <span class="error-message" *ngIf="!validations.newPassword.valid">
              {{ validations.newPassword.message }}
            </span>
          </div>

          <!-- Confirmar Nueva ContraseÃ±a -->
          <div class="form-group">
            <label for="new_password_confirmation">Confirmar Nueva ContraseÃ±a *</label>
            <div class="input-wrapper" [class.error]="!validations.confirmPassword.valid">
              <span class="input-icon">ğŸ”</span>
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="new_password_confirmation"
                [(ngModel)]="formData.new_password_confirmation"
                name="new_password_confirmation"
                placeholder="Repite la nueva contraseÃ±a"
                required
                autocomplete="new-password"
                [disabled]="loading"
                (blur)="onConfirmPasswordBlur()"
              />
              <button
                type="button"
                class="toggle-password"
                (click)="toggleConfirmPassword()"
                [disabled]="loading"
                tabindex="-1"
              >
                <span *ngIf="!showConfirmPassword">ğŸ‘ï¸</span>
                <span *ngIf="showConfirmPassword">ğŸ‘ï¸â€ğŸ—¨ï¸</span>
              </button>
              <span class="validation-icon" 
                    *ngIf="formData.new_password_confirmation && validations.confirmPassword.valid">
                âœ“
              </span>
            </div>
            <span class="error-message" *ngIf="!validations.confirmPassword.valid">
              {{ validations.confirmPassword.message }}
            </span>
          </div>

          <!-- Botones de AcciÃ³n -->
          <div class="form-actions">
            <button 
              type="button" 
              class="btn-cancel"
              (click)="cancelChange()"
              [disabled]="loading"
            >
              Cancelar
            </button>
            
            <button 
              type="submit" 
              class="btn-submit"
              [disabled]="loading"
              [class.loading]="loading"
            >
              <span *ngIf="!loading">
                <span class="btn-icon">ğŸ”’</span>
                <span>Cambiar ContraseÃ±a</span>
              </span>
              <span *ngIf="loading" class="loader-wrapper">
                <span class="spinner"></span>
                <span>Actualizando...</span>
              </span>
            </button>
          </div>
        </form>

        <!-- InformaciÃ³n adicional -->
        <div class="info-box">
          <span class="info-icon">â„¹ï¸</span>
          <div class="info-content">
            <strong>Importante:</strong>
            <p>
              DespuÃ©s de cambiar tu contraseÃ±a, tu sesiÃ³n actual se cerrarÃ¡ 
              automÃ¡ticamente y recibirÃ¡s un nuevo token de autenticaciÃ³n.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>